# UniFFI Swift Package / Binary XCFramework Template

A project template bridging Rust logic to Swift using [UniFFI](https://github.com/mozilla/uniffi-rs).

The Rust project in this repository includes a few basic UniFFI proc macros used generate Swift bindings. The `framework` directory contains the artifacts produced by UniFFI embedded in a binary `XCFramework` that can be imported into a Swift project using [Swift Package Manager](https://www.swift.org/documentation/package-manager/). See the reference section for more detailed documentation on these topics.

## Building the Project

To build the contents of the resulting Swift package, run the build script in this project with:

```console
./build-swift.sh
```

The build script itself works as a reasonable guide for the steps that result in the final Swift framework, but in general the process is:

1. Build the Rust project with `cargo build`.
2. Generate Swift bindings to the project with UniFFI `bindgen`.
3. Build static binaries of the project for all supported architectures required by the Swift package.
4. Bundle the static binaries and supporting Swift logic generated by the `bindgen` step into an `XCFramework`

After building the contents of the framework, the artifacts committed to this repo can then be updated and checked in with:

```console
./install-swift.sh
```

## Consuming the Swift Package

The Swift Package defined in this project can be consumed by adding the project dependency:

```swift
    dependencies: [
        .package(url: "https://github.com/apardee/uniffi-swift-framework.git", from: "1.0.0"),
    ],
```

And linking the target to the library or application:

```swift
    .executableTarget(
        name: "ExampleSwiftApp",
        dependencies: [
            "UniFFISwiftFramework"
        ]),
```

> [!NOTE]  
> This project bundles the Swift Project definition and the Rust project into the same respository for simplicity. When added to a project like this, Swift Package Manager will clone the entire repo including the Rust source. A better approach would serve the target Swift Package in a separate repository.

## Reference

* [SPM XCFramework Reference](https://developer.apple.com/documentation/xcode/creating-a-multi-platform-binary-framework-bundle)
* [UniFFI Project](https://github.com/mozilla/uniffi-rs)
* [UniFFI Swift Reference](https://mozilla.github.io/uniffi-rs/latest/swift/overview.html)
* [Bridging the Gap Between Swift & Rust](https://boehs.org/node/uniffi)
* [Setting up UniFFI for iOS, Simulators, and watchOS](https://codethoughts.io/posts/2024-06-24-setting-up-uniffi-for-ios-simulators-and-watchos/)